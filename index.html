<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Monitta Store â€“ Products</title>
    <style>
      :root {
        color-scheme: light;
        font-family: "Inter", "Segoe UI", system-ui, -apple-system, BlinkMacSystemFont,
          sans-serif;
      }

      *,
      *::before,
      *::after {
        box-sizing: border-box;
      }

      body {
        margin: 0;
        background: #f5f7fb;
        color: #1f2933;
        min-height: 100vh;
      }

      main {
        width: min(1080px, calc(100% - 2.5rem));
        margin: 0 auto;
        padding: clamp(2.5rem, 6vw, 4.5rem) 0;
      }

      header {
        position: relative;
        text-align: center;
        margin-bottom: clamp(2rem, 4vw, 3rem);
        padding-top: clamp(0.75rem, 2.5vw, 1.25rem);
      }

      .header-action {
        position: absolute;
        top: 0;
        right: 0;
      }

      .add-product-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.55rem 1.15rem;
        border-radius: 999px;
        background: linear-gradient(135deg, #2563eb, #7c3aed);
        color: #ffffff;
        font-weight: 600;
        text-decoration: none;
        box-shadow: 0 10px 20px rgba(79, 70, 229, 0.25);
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .add-product-link:hover,
      .add-product-link:focus {
        transform: translateY(-1px);
        box-shadow: 0 14px 28px rgba(79, 70, 229, 0.35);
      }

      .add-product-link:focus-visible {
        outline: 3px solid rgba(37, 99, 235, 0.45);
        outline-offset: 3px;
      }

      h1 {
        margin: 0 0 0.75rem;
        font-size: clamp(2rem, 5vw, 2.75rem);
        color: #101827;
      }

      #product-grid {
        list-style: none;
        padding: 0;
        margin: 0;
        display: grid;
        gap: clamp(1.25rem, 3vw, 1.85rem);
        grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      }

      .product-card {
        background: #ffffff;
        border-radius: 18px;
        overflow: hidden;
        box-shadow: 0 16px 30px rgba(15, 23, 42, 0.08);
        display: flex;
        flex-direction: column;
        min-height: 100%;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .product-card--interactive {
        cursor: pointer;
      }

      .product-card--interactive:focus-visible {
        outline: 3px solid rgba(26, 86, 219, 0.45);
        outline-offset: 4px;
      }

      .product-card:hover,
      .product-card:focus-within {
        transform: translateY(-4px);
        box-shadow: 0 20px 38px rgba(15, 23, 42, 0.12);
      }

      .product-media {
        position: relative;
        padding-top: 62%;
        background: linear-gradient(135deg, rgba(99, 102, 241, 0.12), rgba(14, 165, 233, 0.08));
      }

      .product-media img {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
      }

      .product-info {
        padding: 1.4rem 1.6rem 1.6rem;
        display: flex;
        flex-direction: column;
        gap: 0.85rem;
        flex: 1;
      }

      .product-title-row {
        display: flex;
        justify-content: space-between;
        gap: 1rem;
        align-items: flex-start;
      }

      .product-name {
        color: #1a56db;
        text-decoration: none;
        font-weight: 600;
        font-size: 1.1rem;
        line-height: 1.35;
      }

      .product-name:hover,
      .product-name:focus {
        text-decoration: underline;
      }

      .product-description {
        margin: 0;
        color: #52606d;
        line-height: 1.6;
      }

      @media (max-width: 640px) {
        main {
          width: min(100%, calc(100% - 1.5rem));
        }

        .product-info {
          padding: 1.25rem 1.35rem 1.5rem;
        }
      }
    </style>
  </head>
  <body>
    <main>
      <header>
        <div class="header-action">
          <a class="add-product-link" href="product_add.html">Add Product</a>
        </div>
        <h1>Monitta Store Products</h1>
      </header>

      <ul id="product-grid" hidden aria-label="Products"></ul>

      <template id="product-card-template">
        <li class="product-card">
          <div class="product-media">
            <img alt="Product image" loading="lazy" />
          </div>
          <div class="product-info">
            <div class="product-title-row">
              <a class="product-name"></a>
            </div>
            <p class="product-description"></p>
          </div>
        </li>
      </template>
    </main>

    <script>
      const endpoint =
        "https://vintagecrawlerappservice-hqb0f5bmfrdwf0g7.polandcentral-01.azurewebsites.net/products";
      const gridElement = document.getElementById("product-grid");
      const template = document.getElementById("product-card-template");

      function createProductDetailsUrl(productId) {
        if (productId == null) {
          return "";
        }

        const normalizedId = String(productId).trim();
        if (!normalizedId) {
          return "";
        }

        try {
          const detailsUrl = new URL("product.html", window.location.href);
          detailsUrl.searchParams.set("productID", normalizedId);
          return detailsUrl.toString();
        } catch (error) {
          const encodedId = encodeURIComponent(normalizedId);
          return `product.html?productID=${encodedId}`;
        }
      }

      function getProductId(product) {
        if (!product) {
          return "";
        }

        if (typeof product.id === "string") {
          return product.id.trim();
        }

        if (product.id != null) {
          return String(product.id).trim();
        }

        return "";
      }

      function getProductName(product) {
        if (typeof product?.Name === "string") {
          const trimmed = product.Name.trim();
          if (trimmed) {
            return trimmed;
          }
        }

        return "Product";
      }

      function getProductDescription(product) {
        if (typeof product?.Description === "string") {
          const trimmed = product.Description.trim();
          if (trimmed) {
            return trimmed;
          }
        }

        return "";
      }

      function getPrimaryImage(product) {
        if (!Array.isArray(product?.Images)) {
          return "";
        }

        for (const image of product.Images) {
          if (typeof image === "string") {
            const trimmed = image.trim();
            if (trimmed) {
              return trimmed;
            }
          }
        }

        return "";
      }

      async function loadProducts() {
        try {
          const response = await fetch(endpoint);
          if (!response.ok) {
            throw new Error(`Request failed with status ${response.status}`);
          }

          const payload = await response.json();
          const products = Array.isArray(payload)
            ? payload
            : Array.isArray(payload?.products)
            ? payload.products
            : Array.isArray(payload?.items)
            ? payload.items
            : Array.isArray(payload?.data)
            ? payload.data
            : [];

          if (!products.length) {
            gridElement.innerHTML = "";
            gridElement.hidden = false;
            return;
          }

          const fragment = document.createDocumentFragment();

          for (const product of products) {
            const instance = template.content.cloneNode(true);
            const card = instance.querySelector(".product-card");
            const media = instance.querySelector(".product-media");
            const image = instance.querySelector("img");
            const nameLink = instance.querySelector(".product-name");
            const descriptionElement = instance.querySelector(".product-description");

            const title = getProductName(product);
            const productId = getProductId(product);
            const detailsPageUrl = productId
              ? createProductDetailsUrl(productId)
              : "";

            nameLink.textContent = title;
            if (detailsPageUrl) {
              nameLink.href = detailsPageUrl;
              card.classList.add("product-card--interactive");
              card.dataset.productId = productId;
              card.setAttribute("role", "link");
              card.tabIndex = 0;

              const navigateToDetails = () => {
                window.location.href = detailsPageUrl;
              };

              card.addEventListener("click", (event) => {
                if (event.target.closest("a, button")) {
                  return;
                }
                navigateToDetails();
              });

              card.addEventListener("keydown", (event) => {
                if (event.key === "Enter" || event.key === " ") {
                  event.preventDefault();
                  navigateToDetails();
                }
              });
            } else {
              nameLink.removeAttribute("href");
              delete card.dataset.productId;
              card.classList.remove("product-card--interactive");
              card.removeAttribute("role");
              card.removeAttribute("tabindex");
            }

            const description = getProductDescription(product);
            if (description) {
              descriptionElement.textContent = description;
            } else {
              descriptionElement.remove();
            }

            const imageUrl = getPrimaryImage(product);
            if (imageUrl) {
              image.src = imageUrl;
              image.alt = `${title} image`;
            } else {
              media.remove();
              card.classList.add("product-card--no-image");
            }

            fragment.appendChild(instance);
          }

          gridElement.innerHTML = "";
          gridElement.appendChild(fragment);
          gridElement.hidden = false;
        } catch (error) {
          console.error(error);
        }
      }

      loadProducts();
    </script>
  </body>
</html>
